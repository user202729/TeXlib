% NOTE there's l3benchmark package too
\ProvidesExplPackage{benchmark}{2022/03/25}{0.0.0}{Benchmark}
\RequirePackage{pretty}
\RequirePackage{pdftexcmds}

%\directlua{
%	function benchmark_f(x){
%	}
%}

\global\def \g_benchmark_lasttime {0}
\global\def \g_benchmark_lastmessage {0}

\def \benchmark #1 {
	%\directlua{benchmark_f(\number\pdf@elapsedtime)}
	\str_gset:Nn \g_benchmark_message {#1}
	\letin:xNn {\number\pdf@elapsedtime} \t {
		\pretty:x {
			(\g_benchmark_lastmessage)~ ->~ (\g_benchmark_message): ~
			\fp_eval:n {(\t - \g_benchmark_lasttime)/65536}s
		}
		\global\def \g_benchmark_lasttime {\t}
	}
	\global\let \g_benchmark_lastmessage \g_benchmark_message
}
