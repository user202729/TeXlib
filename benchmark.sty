% NOTE there's l3benchmark package too
\ProvidesExplPackage{benchmark}{2022/03/25}{0.0.0}{Benchmark}
\RequirePackage{pretty}
\RequirePackage{letin}
\RequirePackage{pdftexcmds}

\cs_generate_variant:Nn \letin:nNn {xNn}

%\directlua{
%	function benchmark_f(x){
%	}
%}

\global\def \g_benchmark_lasttime {0}
\global\def \g_benchmark_lastmessage {0}

\def \benchmark #1 {
	%\directlua{benchmark_f(\number\pdf@elapsedtime)}
	\str_gset:Nn \g_benchmark_message {#1}
	\benchmark_aux:o {\number\pdf@elapsedtime}
	\global\let \g_benchmark_lastmessage \g_benchmark_message
}

\cs_set_protected:Npn \benchmark_aux:n #1 {
	\pretty:x {
		(\g_benchmark_lastmessage)~ ->~ (\g_benchmark_message): ~
		\fp_eval:n {(#1 - \g_benchmark_lasttime)/65536}s
	}
	\global\def \g_benchmark_lasttime {#1}
}
\cs_generate_variant:Nn \benchmark_aux:n {o}
